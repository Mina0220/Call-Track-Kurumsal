import React, { useState, useEffect, useMemo, useCallback } from 'react';
import {
  Phone,
  Calendar,
  User,
  Building,
  MapPin,
  Briefcase,
  CheckCircle,
  XCircle,
  Clock,
  BarChart3,
  List,
  Trash2,
  PieChart,
  FileText,
  Search,
  Smartphone,
  UserCircle,
  Download,
  CalendarDays,
  Edit,
  Filter,
  X,
  Bell,
  AlertTriangle,
  Upload,
  Save,
  ChevronLeft,
  ChevronRight,
  TrendingUp,
  Activity,
  Target,
  Moon,
  Sun,
  Settings,
  Zap,
  Star,
  Award,
  ThumbsUp,
  Eye,
  Sparkles,
  Flame,
  TrendingDown,
  RefreshCw,
  Copy,
  Share2,
  Mail,
  Grid,
  LayoutGrid
} from 'lucide-react';

// --- SABÄ°T VERÄ°LER ---
const CALLERS = ["Aysun", "HÃ¼lya", "Mert", "TuÄŸbahan", "Yakup"];

// --- Ä°L ve Ä°LÃ‡E VERÄ°TABANI ---
const CITIES_DATA = {
  "Adana": ["Seyhan", "YÃ¼reÄŸir", "Ã‡ukurova", "SarÄ±Ã§am", "Ceyhan", "Kozan", "Ä°mamoÄŸlu", "KarataÅŸ", "KaraisalÄ±", "PozantÄ±", "YumurtalÄ±k", "Tufanbeyli", "Feke", "AladaÄŸ", "Saimbeyli"],
  "AdÄ±yaman": ["Merkez", "Kahta", "Besni", "GÃ¶lbaÅŸÄ±", "Gerger", "Sincik", "Ã‡elikhan", "Tut", "Samsat"],
  "Afyonkarahisar": ["Merkez", "SandÄ±klÄ±", "Dinar", "Bolvadin", "SinanpaÅŸa", "EmirdaÄŸ", "Åuhut", "Ã‡ay", "Ä°hsaniye", "Ä°scehisar", "SultandaÄŸÄ±", "Ã‡obanlar", "DazkÄ±rÄ±", "BaÅŸmakÃ§Ä±", "Evciler", "Bayat", "Hocalar", "KÄ±zÄ±lÃ¶ren"],
  "AÄŸrÄ±": ["Merkez", "Patnos", "DoÄŸubayazÄ±t", "Diyadin", "EleÅŸkirt", "Tutak", "TaÅŸlÄ±Ã§ay", "Hamur"],
  "Aksaray": ["Merkez", "OrtakÃ¶y", "Eskil", "GÃ¼laÄŸaÃ§", "GÃ¼zelyurt", "AÄŸaÃ§Ã¶ren", "SarÄ±yahÅŸi"],
  "Amasya": ["Merkez", "Merzifon", "Suluova", "TaÅŸova", "GÃ¼mÃ¼ÅŸhacÄ±kÃ¶y", "GÃ¶ynÃ¼cek", "HamamÃ¶zÃ¼"],
  "Ankara": ["Ã‡ankaya", "KeÃ§iÃ¶ren", "Yenimahalle", "Mamak", "Etimesgut", "Sincan", "AltÄ±ndaÄŸ", "Pursaklar", "GÃ¶lbaÅŸÄ±", "PolatlÄ±", "Ã‡ubuk", "Kahramankazan", "BeypazarÄ±", "ElmadaÄŸ", "ÅereflikoÃ§hisar", "Akyurt", "NallÄ±han", "Haymana", "KÄ±zÄ±lcahamam", "Bala", "Kalecik", "AyaÅŸ", "GÃ¼dÃ¼l", "Ã‡amlÄ±dere", "Evren"],
  "Antalya": ["Kepez", "MuratpaÅŸa", "Alanya", "Manavgat", "KonyaaltÄ±", "Serik", "Aksu", "DÃ¶ÅŸemealtÄ±", "Kumluca", "KaÅŸ", "Korkuteli", "GazipaÅŸa", "Finike", "Kemer", "ElmalÄ±", "Demre", "Akseki", "GÃ¼ndoÄŸmuÅŸ", "Ä°bradÄ±"],
  "Ardahan": ["Merkez", "GÃ¶le", "Ã‡Ä±ldÄ±r", "Hanak", "Posof", "Damal"],
  "Artvin": ["Merkez", "Hopa", "BorÃ§ka", "Yusufeli", "Arhavi", "ÅavÅŸat", "Murgul", "ArdanuÃ§", "KemalpaÅŸa"],
  "AydÄ±n": ["Efeler", "Nazilli", "SÃ¶ke", "KuÅŸadasÄ±", "Didim", "Germencik", "Ä°ncirliova", "Ã‡ine", "KÃ¶ÅŸk", "Kuyucak", "BozdoÄŸan", "Sultanhisar", "Karacasu", "Yenipazar", "Buharkent", "Karpuzlu"],
  "BalÄ±kesir": ["AltÄ±eylÃ¼l", "Karesi", "Edremit", "BandÄ±rma", "GÃ¶nen", "AyvalÄ±k", "Burhaniye", "BigadiÃ§", "Susurluk", "Dursunbey", "SÄ±ndÄ±rgÄ±", "Ä°vrindi", "Erdek", "Havran", "Kepsut", "Manyas", "SavaÅŸtepe", "Balya", "GÃ¶meÃ§", "Marmara"],
  "BartÄ±n": ["Merkez", "Ulus", "Amasra", "KurucaÅŸile"],
  "Batman": ["Merkez", "Kozluk", "Sason", "BeÅŸiri", "GercÃ¼ÅŸ", "Hasankeyf"],
  "Bayburt": ["Merkez", "DemirÃ¶zÃ¼", "AydÄ±ntepe"],
  "Bilecik": ["Merkez", "BozÃ¼yÃ¼k", "Osmaneli", "SÃ¶ÄŸÃ¼t", "GÃ¶lpazarÄ±", "Pazaryeri", "Ä°nhisar", "Yenipazar"],
  "BingÃ¶l": ["Merkez", "GenÃ§", "Solhan", "KarlÄ±ova", "AdaklÄ±", "KiÄŸÄ±", "Yedisu", "Yayladere"],
  "Bitlis": ["Tatvan", "Merkez", "GÃ¼roymak", "Ahlat", "Hizan", "Mutki", "Adilcevaz"],
  "Bolu": ["Merkez", "Gerede", "Mudurnu", "GÃ¶ynÃ¼k", "Mengen", "YeniÃ§aÄŸa", "DÃ¶rtdivan", "Seben", "KÄ±brÄ±scÄ±k"],
  "Burdur": ["Merkez", "Bucak", "GÃ¶lhisar", "YeÅŸilova", "Ã‡avdÄ±r", "Tefenni", "AÄŸlasun", "KaramanlÄ±", "AltÄ±nyayla", "Ã‡eltikÃ§i", "Kemer"],
  "Bursa": ["Osmangazi", "YÄ±ldÄ±rÄ±m", "NilÃ¼fer", "Ä°negÃ¶l", "Gemlik", "MustafakemalpaÅŸa", "Mudanya", "GÃ¼rsu", "Karacabey", "Orhangazi", "Kestel", "YeniÅŸehir", "Ä°znik", "Orhaneli", "Keles", "BÃ¼yÃ¼korhan", "HarmancÄ±k"],
  "Ã‡anakkale": ["Merkez", "Biga", "Ã‡an", "Gelibolu", "AyvacÄ±k", "Yenice", "Ezine", "BayramiÃ§", "Lapseki", "Eceabat", "GÃ¶kÃ§eada", "Bozcaada"],
  "Ã‡ankÄ±rÄ±": ["Merkez", "Ã‡erkeÅŸ", "Ilgaz", "Orta", "ÅabanÃ¶zÃ¼", "KurÅŸunlu", "YapraklÄ±", "KÄ±zÄ±lÄ±rmak", "Eldivan", "Atkaracalar", "Korgun", "BayramÃ¶ren"],
  "Ã‡orum": ["Merkez", "Sungurlu", "OsmancÄ±k", "Ä°skilip", "Alaca", "Bayat", "MecitÃ¶zÃ¼", "KargÄ±", "OrtakÃ¶y", "UÄŸurludaÄŸ", "Dodurga", "OÄŸuzlar", "LaÃ§in", "BoÄŸazkale"],
  "Denizli": ["Pamukkale", "Merkezefendi", "Ã‡ivril", "AcÄ±payam", "Tavas", "Honaz", "SaraykÃ¶y", "Buldan", "Kale", "Ã‡al", "Ã‡ameli", "Serinhisar", "Bozkurt", "GÃ¼ney", "Ã‡ardak", "Bekilli", "BeyaÄŸaÃ§", "BabadaÄŸ", "Baklan"],
  "DiyarbakÄ±r": ["BaÄŸlar", "KayapÄ±nar", "YeniÅŸehir", "Sur", "Ergani", "Bismil", "Silvan", "Ã‡Ä±nar", "Ã‡ermik", "Dicle", "Kulp", "Hani", "Lice", "EÄŸil", "Hazro", "KocakÃ¶y", "Ã‡Ã¼ngÃ¼ÅŸ"],
  "DÃ¼zce": ["Merkez", "AkÃ§akoca", "KaynaÅŸlÄ±", "GÃ¶lyaka", "Ã‡ilimli", "YÄ±ÄŸÄ±lca", "GÃ¼mÃ¼ÅŸova", "Cumayeri"],
  "Edirne": ["Merkez", "KeÅŸan", "UzunkÃ¶prÃ¼", "Ä°psala", "Havsa", "MeriÃ§", "Enez", "SÃ¼loÄŸlu", "LalapaÅŸa"],
  "ElazÄ±ÄŸ": ["Merkez", "KovancÄ±lar", "KarakoÃ§an", "Palu", "ArÄ±cak", "Baskil", "Maden", "Sivrice", "Alacakaya", "Keban", "AÄŸÄ±n"],
  "Erzincan": ["Merkez", "Tercan", "ÃœzÃ¼mlÃ¼", "Ã‡ayÄ±rlÄ±", "Ä°liÃ§", "Kemah", "Kemaliye", "Otlukbeli", "Refahiye"],
  "Erzurum": ["Yakutiye", "PalandÃ¶ken", "Aziziye", "Horasan", "Oltu", "Pasinler", "KarayazÄ±", "HÄ±nÄ±s", "Tekman", "KaraÃ§oban", "AÅŸkale", "Åenkaya", "Ã‡at", "KÃ¶prÃ¼kÃ¶y", "Ä°spir", "Tortum", "Narman", "Uzundere", "Olur", "Pazaryolu"],
  "EskiÅŸehir": ["OdunpazarÄ±", "TepebaÅŸÄ±", "Sivrihisar", "Ã‡ifteler", "Seyitgazi", "Alpu", "MihalÄ±Ã§Ã§Ä±k", "Mahmudiye", "Beylikova", "Ä°nÃ¶nÃ¼", "GÃ¼nyÃ¼zÃ¼", "SarÄ±cakaya", "Mihalgazi", "Han"],
  "Gaziantep": ["Åahinbey", "Åehitkamil", "Nizip", "Ä°slahiye", "NurdaÄŸÄ±", "Araban", "OÄŸuzeli", "Yavuzeli", "KarkamÄ±ÅŸ"],
  "Giresun": ["Merkez", "Bulancak", "Espiye", "GÃ¶rele", "Tirebolu", "Dereli", "YaÄŸlÄ±dere", "KeÅŸap", "Eynesil", "Åebinkarahisar", "Piraziz", "GÃ¼ce", "Ã‡amoluk", "DoÄŸankent", "Alucra", "Ã‡anakÃ§Ä±"],
  "GÃ¼mÃ¼ÅŸhane": ["Merkez", "Kelkit", "Åiran", "KÃ¼rtÃ¼n", "Torul", "KÃ¶se"],
  "Hakkari": ["YÃ¼ksekova", "Merkez", "Åemdinli", "Ã‡ukurca", "Derecik"],
  "Hatay": ["Antakya", "Ä°skenderun", "Defne", "DÃ¶rtyol", "SamandaÄŸ", "KÄ±rÄ±khan", "ReyhanlÄ±", "Arsuz", "AltÄ±nÃ¶zÃ¼", "Hassa", "Payas", "Erzin", "YayladaÄŸÄ±", "Belen", "Kumlu"],
  "IÄŸdÄ±r": ["Merkez", "Tuzluca", "AralÄ±k", "Karakoyunlu"],
  "Isparta": ["Merkez", "YalvaÃ§", "EÄŸirdir", "ÅarkikaraaÄŸaÃ§", "Gelendost", "KeÃ§iborlu", "Senirkent", "SÃ¼tÃ§Ã¼ler", "GÃ¶nen", "Uluborlu", "Atabey", "Aksu", "YeniÅŸarbademli"],
  "Ä°stanbul": ["Esenyurt", "KÃ¼Ã§Ã¼kÃ§ekmece", "BaÄŸcÄ±lar", "Pendik", "Ãœmraniye", "BahÃ§elievler", "Sultangazi", "Maltepe", "ÃœskÃ¼dar", "GaziosmanpaÅŸa", "KadÄ±kÃ¶y", "Kartal", "BaÅŸakÅŸehir", "Esenler", "AvcÄ±lar", "KaÄŸÄ±thane", "Fatih", "Sancaktepe", "AtaÅŸehir", "EyÃ¼psultan", "BeylikdÃ¼zÃ¼", "SarÄ±yer", "Sultanbeyli", "Zeytinburnu", "GÃ¼ngÃ¶ren", "ArnavutkÃ¶y", "ÅiÅŸli", "BayrampaÅŸa", "Tuzla", "Ã‡ekmekÃ¶y", "BÃ¼yÃ¼kÃ§ekmece", "Beykoz", "BeyoÄŸlu", "BakÄ±rkÃ¶y", "Silivri", "BeÅŸiktaÅŸ", "Ã‡atalca", "Åile", "Adalar"],
  "Ä°zmir": ["Buca", "KarabaÄŸlar", "Bornova", "Konak", "KarÅŸÄ±yaka", "BayraklÄ±", "Ã‡iÄŸli", "TorbalÄ±", "Menemen", "Gaziemir", "Ã–demiÅŸ", "KemalpaÅŸa", "Bergama", "AliaÄŸa", "Menderes", "Tire", "BalÃ§ova", "NarlÄ±dere", "Urla", "Kiraz", "Dikili", "BayÄ±ndÄ±r", "Seferihisar", "SelÃ§uk", "GÃ¼zelbahÃ§e", "FoÃ§a", "KÄ±nÄ±k", "BeydaÄŸ", "Karaburun"],
  "KahramanmaraÅŸ": ["OnikiÅŸubat", "DulkadiroÄŸlu", "Elbistan", "AfÅŸin", "TÃ¼rkoÄŸlu", "PazarcÄ±k", "GÃ¶ksun", "AndÄ±rÄ±n", "Ã‡aÄŸlayancerit", "Nurhak", "EkinÃ¶zÃ¼"],
  "KarabÃ¼k": ["Merkez", "Safranbolu", "Yenice", "Eskipazar", "Eflani", "OvacÄ±k"],
  "Karaman": ["Merkez", "Ermenek", "SarÄ±veliler", "AyrancÄ±", "KazÄ±mkarabekir", "BaÅŸyayla"],
  "Kars": ["Merkez", "KaÄŸÄ±zman", "SarÄ±kamÄ±ÅŸ", "Selim", "Digor", "ArpaÃ§ay", "Akyaka", "Susuz"],
  "Kastamonu": ["Merkez", "Tosya", "TaÅŸkÃ¶prÃ¼", "Cide", "Ä°nebolu", "AraÃ§", "Devrekani", "Bozkurt", "Daday", "Azdavay", "Ã‡atalzeytin", "KÃ¼re", "DoÄŸanyurt", "Ä°hsangazi", "PÄ±narbaÅŸÄ±", "Åenpazar", "Abana", "Seydiler", "HanÃ¶nÃ¼", "AÄŸlÄ±"],
  "Kayseri": ["Melikgazi", "Kocasinan", "Talas", "Develi", "YahyalÄ±", "BÃ¼nyan", "Ä°ncesu", "PÄ±narbaÅŸÄ±", "Tomarza", "YeÅŸilhisar", "SarÄ±oÄŸlan", "HacÄ±lar", "SarÄ±z", "AkkÄ±ÅŸla", "Felahiye", "Ã–zvatan"],
  "KÄ±rÄ±kkale": ["Merkez", "YahÅŸihan", "Keskin", "Delice", "BahÅŸÄ±lÄ±", "Sulakyurt", "BalÄ±ÅŸeyh", "KarakeÃ§ili", "Ã‡elebi"],
  "KÄ±rklareli": ["LÃ¼leburgaz", "Merkez", "Babaeski", "Vize", "PÄ±narhisar", "DemirkÃ¶y", "PehlivankÃ¶y", "KofÃ§az"],
  "KÄ±rÅŸehir": ["Merkez", "Kaman", "Mucur", "Ã‡iÃ§ekdaÄŸÄ±", "AkpÄ±nar", "Boztepe", "AkÃ§akent"],
  "Kilis": ["Merkez", "Musabeyli", "Elbeyli", "Polateli"],
  "Kocaeli": ["Gebze", "Ä°zmit", "DarÄ±ca", "KÃ¶rfez", "GÃ¶lcÃ¼k", "Derince", "Ã‡ayÄ±rova", "Kartepe", "BaÅŸiskele", "KaramÃ¼rsel", "KandÄ±ra", "DilovasÄ±"],
  "Konya": ["SelÃ§uklu", "Meram", "Karatay", "EreÄŸli", "AkÅŸehir", "BeyÅŸehir", "Ã‡umra", "SeydiÅŸehir", "IlgÄ±n", "Cihanbeyli", "Kulu", "KarapÄ±nar", "KadÄ±nhanÄ±", "SarayÃ¶nÃ¼", "BozkÄ±r", "Yunak", "DoÄŸanhisar", "HÃ¼yÃ¼k", "AltÄ±nekin", "Hadim", "Ã‡eltik", "GÃ¼neysÄ±nÄ±r", "Emirgazi", "TaÅŸkent", "TuzlukÃ§u", "Derebucak", "AkÃ¶ren", "AhÄ±rlÄ±", "HalkapÄ±nar", "YalÄ±hÃ¼yÃ¼k"],
  "KÃ¼tahya": ["Merkez", "TavÅŸanlÄ±", "Simav", "Gediz", "Emet", "AltÄ±ntaÅŸ", "DomaniÃ§", "HisarcÄ±k", "Aslanapa", "Ã‡avdarhisar", "Åaphane", "Pazarlar", "DumlupÄ±nar"],
  "Malatya": ["Battalgazi", "YeÅŸilyurt", "DoÄŸanÅŸehir", "AkÃ§adaÄŸ", "Darende", "Hekimhan", "YazÄ±han", "PÃ¼tÃ¼rge", "Arapgir", "Kuluncak", "Arguvan", "Kale", "DoÄŸanyol"],
  "Manisa": ["Yunusemre", "Åehzadeler", "Akhisar", "Turgutlu", "Salihli", "Soma", "AlaÅŸehir", "SaruhanlÄ±", "Kula", "KÄ±rkaÄŸaÃ§", "Demirci", "SarÄ±gÃ¶l", "GÃ¶rdes", "Selendi", "Ahmetli", "GÃ¶lmarmara", "KÃ¶prÃ¼baÅŸÄ±"],
  "Mardin": ["KÄ±zÄ±ltepe", "Artuklu", "Midyat", "Nusaybin", "Derik", "MazÄ±daÄŸÄ±", "DargeÃ§it", "Savur", "YeÅŸilli", "Ã–merli"],
  "Mersin": ["Tarsus", "Toroslar", "YeniÅŸehir", "Akdeniz", "Mezitli", "Erdemli", "Silifke", "Anamur", "Mut", "BozyazÄ±", "GÃ¼lnar", "AydÄ±ncÄ±k", "Ã‡amlÄ±yayla"],
  "MuÄŸla": ["Bodrum", "Fethiye", "Milas", "MenteÅŸe", "Marmaris", "Seydikemer", "Ortaca", "Dalaman", "YataÄŸan", "KÃ¶yceÄŸiz", "Ula", "DatÃ§a", "KavaklÄ±dere"],
  "MuÅŸ": ["Merkez", "BulanÄ±k", "Malazgirt", "Varto", "HaskÃ¶y", "Korkut"],
  "NevÅŸehir": ["Merkez", "ÃœrgÃ¼p", "Avanos", "GÃ¼lÅŸehir", "Derinkuyu", "AcÄ±gÃ¶l", "KozaklÄ±", "HacÄ±bektaÅŸ"],
  "NiÄŸde": ["Merkez", "Bor", "Ã‡iftlik", "UlukÄ±ÅŸla", "Altunhisar", "Ã‡amardÄ±"],
  "Ordu": ["AltÄ±nordu", "Ãœnye", "Fatsa", "GÃ¶lkÃ¶y", "PerÅŸembe", "Kumru", "Korgan", "AkkuÅŸ", "AybastÄ±", "Ulubey", "Ä°kizce", "Mesudiye", "GÃ¼rgentepe", "Ã‡atalpÄ±nar", "Ã‡aybaÅŸÄ±", "KabataÅŸ", "KabadÃ¼z", "Ã‡amaÅŸ", "GÃ¼lyalÄ±"],
  "Osmaniye": ["Merkez", "Kadirli", "DÃ¼ziÃ§i", "BahÃ§e", "Toprakkale", "Sumbas", "Hasanbeyli"],
  "Rize": ["Merkez", "Ã‡ayeli", "ArdeÅŸen", "Pazar", "FÄ±ndÄ±klÄ±", "GÃ¼neysu", "Kalkandere", "Ä°yidere", "DerepazarÄ±", "Ã‡amlÄ±hemÅŸin", "Ä°kizdere", "HemÅŸin"],
  "Sakarya": ["AdapazarÄ±", "Serdivan", "AkyazÄ±", "Erenler", "Hendek", "Karasu", "Geyve", "Arifiye", "Sapanca", "Pamukova", "Ferizli", "Kaynarca", "Kocaali", "SÃ¶ÄŸÃ¼tlÃ¼", "KarapÃ¼rÃ§ek", "TaraklÄ±"],
  "Samsun": ["Ä°lkadÄ±m", "Atakum", "Bafra", "Ã‡arÅŸamba", "Canik", "VezirkÃ¶prÃ¼", "Terme", "TekkekÃ¶y", "Havza", "AlaÃ§am", "19 MayÄ±s", "Kavak", "SalÄ±pazarÄ±", "AyvacÄ±k", "AsarcÄ±k", "Ladik", "Yakakent"],
  "Siirt": ["Merkez", "Kurtalan", "Pervari", "Baykan", "Åirvan", "Eruh", "Tillo"],
  "Sinop": ["Merkez", "Boyabat", "Gerze", "AyancÄ±k", "DuraÄŸan", "TÃ¼rkeli", "Erfelek", "Dikmen", "SaraydÃ¼zÃ¼"],
  "Sivas": ["Merkez", "ÅarkÄ±ÅŸla", "YÄ±ldÄ±zeli", "SuÅŸehri", "Gemerek", "Zara", "Kangal", "GÃ¼rÃ¼n", "DivriÄŸi", "Koyulhisar", "Hafik", "UlaÅŸ", "AltÄ±nyayla", "Ä°mranlÄ±", "AkÄ±ncÄ±lar", "GÃ¶lova", "DoÄŸanÅŸar"],
  "ÅanlÄ±urfa": ["EyyÃ¼biye", "Haliliye", "Siverek", "ViranÅŸehir", "KarakÃ¶prÃ¼", "AkÃ§akale", "SuruÃ§", "Birecik", "Harran", "CeylanpÄ±nar", "Bozova", "Hilvan", "Halfeti"],
  "ÅÄ±rnak": ["Cizre", "Silopi", "Merkez", "Ä°dil", "Uludere", "BeytÃ¼ÅŸÅŸebap", "GÃ¼Ã§lÃ¼konak"],
  "TekirdaÄŸ": ["Ã‡orlu", "SÃ¼leymanpaÅŸa", "Ã‡erkezkÃ¶y", "KapaklÄ±", "Ergene", "Malkara", "Saray", "Hayrabolu", "ÅarkÃ¶y", "MuratlÄ±", "MarmaraereÄŸlisi"],
  "Tokat": ["Merkez", "Erbaa", "Turhal", "Niksar", "Zile", "ReÅŸadiye", "Almus", "Pazar", "BaÅŸÃ§iftlik", "YeÅŸilyurt", "Artova", "Sulusaray"],
  "Trabzon": ["Ortahisar", "AkÃ§aabat", "AraklÄ±", "Of", "Yomra", "Arsin", "VakfÄ±kebir", "SÃ¼rmene", "MaÃ§ka", "BeÅŸikdÃ¼zÃ¼", "Ã‡arÅŸÄ±baÅŸÄ±", "Tonya", "DÃ¼zkÃ¶y", "Ã‡aykara", "ÅalpazarÄ±", "Hayrat", "KÃ¶prÃ¼baÅŸÄ±", "DernekpazarÄ±"],
  "Tunceli": ["Merkez", "Pertek", "Mazgirt", "Ã‡emiÅŸgezek", "Hozat", "OvacÄ±k", "PÃ¼lÃ¼mÃ¼r", "NazÄ±miye"],
  "UÅŸak": ["Merkez", "Banaz", "EÅŸme", "SivaslÄ±", "Ulubey", "KarahallÄ±"],
  "Van": ["Ä°pekyolu", "ErciÅŸ", "TuÅŸba", "Edremit", "Ã–zalp", "Ã‡aldÄ±ran", "BaÅŸkale", "Muradiye", "GÃ¼rpÄ±nar", "GevaÅŸ", "Saray", "Ã‡atak", "BahÃ§esaray"],
  "Yalova": ["Merkez", "Ã‡iftlikkÃ¶y", "Ã‡Ä±narcÄ±k", "AltÄ±nova", "Armutlu", "Termal"],
  "Yozgat": ["Merkez", "Sorgun", "AkdaÄŸmadeni", "YerkÃ¶y", "BoÄŸazlÄ±yan", "SarÄ±kaya", "Ã‡ekerek", "Åefaatli", "Saraykent", "Ã‡ayÄ±ralan", "KadÄ±ÅŸehri", "AydÄ±ncÄ±k", "YenifakÄ±lÄ±", "Ã‡andÄ±r"],
  "Zonguldak": ["EreÄŸli", "Merkez", "Ã‡aycuma", "Devrek", "Kozlu", "AlaplÄ±", "Kilimli", "GÃ¶kÃ§ebey"]
};

// --- YARDIMCI FONKSÄ°YONLAR ---

// Telefon NumarasÄ± FormatlayÄ±cÄ±: (555) 123 45 67
const formatPhoneNumber = (value) => {
  if (!value) return value;
  
  // Sadece rakamlarÄ± al
  const phoneNumber = value.replace(/[^\d]/g, '');
  const phoneNumberLength = phoneNumber.length;

  if (phoneNumberLength < 4) return phoneNumber;
  if (phoneNumberLength < 7) {
    return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3)}`;
  }
  return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3, 6)} ${phoneNumber.slice(6, 10)}`;
};

// --- YardÄ±mcÄ± BileÅŸenler ---

const Card = ({ children, className = "" }) => (
  <div className={`bg-white rounded-xl shadow-sm border border-slate-200 ${className}`}>
    {children}
  </div>
);

const Badge = ({ children, type }) => {
  const styles = {
    success: "bg-green-100 text-green-700",
    warning: "bg-yellow-100 text-yellow-700",
    danger: "bg-red-100 text-red-700",
    neutral: "bg-slate-100 text-slate-700",
    blue: "bg-blue-100 text-blue-700"
  };
  return (
    <span className={`px-2 py-1 rounded-full text-xs font-medium ${styles[type] || styles.neutral}`}>
      {children}
    </span>
  );
};

// --- Sabitler ---
const HOURS = Array.from({ length: 10 }, (_, i) => (i + 9).toString().padStart(2, '0')); // 09 - 18
const MINUTES = Array.from({ length: 60 }, (_, i) => i.toString().padStart(2, '0')); // 00 - 59
const ITEMS_PER_PAGE = 25; // Pagination iÃ§in sayfa baÅŸÄ±na kayÄ±t sayÄ±sÄ±

// --- Ana Uygulama ---

export default function App() {
  // Durum YÃ¶netimi (State)
  const [activeTab, setActiveTab] = useState('entry'); // entry, list, reports
  const [calls, setCalls] = useState(() => {
    const saved = localStorage.getItem('companyCalls');
    return saved ? JSON.parse(saved) : [];
  });
  
  // Arama ve Filtreleme State'leri
  const [searchTerm, setSearchTerm] = useState('');
  const [filterResult, setFilterResult] = useState('');
  const [filterCaller, setFilterCaller] = useState('');
  const [filterCity, setFilterCity] = useState('');
  const [filterDateRange, setFilterDateRange] = useState({ start: '', end: '' });

  // Pagination State
  const [currentPage, setCurrentPage] = useState(1);

  // DÃ¼zenleme (Edit) State'i
  const [editingId, setEditingId] = useState(null);

  // Notification State
  const [notification, setNotification] = useState(null);

  // Dark Mode State
  const [darkMode, setDarkMode] = useState(() => {
    const saved = localStorage.getItem('darkMode');
    return saved ? JSON.parse(saved) : false;
  });

  // View Mode State (grid vs list)
  const [viewMode, setViewMode] = useState('list'); // 'list' or 'grid'

  // Quick Stats State
  const [showQuickStats, setShowQuickStats] = useState(true);

  const [formData, setFormData] = useState({
    caller: '', 
    companyName: '',
    callDate: new Date().toISOString().split('T')[0], 
    callTime: (() => {
      const now = new Date();
      const currentHour = now.getHours();
      let hour = currentHour;
      let minute = now.getMinutes(); 
      if (currentHour < 9) { hour = 9; minute = 0; }
      else if (currentHour > 18 || (currentHour === 18 && minute > 0)) { hour = 18; minute = 0; }
      return `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
    })(),
    contactPerson: '',
    contactTitle: '',
    contactPhone: '',
    newContactPhone: '',
    industry: '',
    city: '',
    district: '',
    result: 'GÃ¶rÃ¼ÅŸÃ¼ldÃ¼',
    notes: ''
  });

  // Veriler deÄŸiÅŸtikÃ§e kaydet
  useEffect(() => {
    localStorage.setItem('companyCalls', JSON.stringify(calls));
  }, [calls]);

  // Dark Mode kaydet
  useEffect(() => {
    localStorage.setItem('darkMode', JSON.stringify(darkMode));
    if (darkMode) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }, [darkMode]);

  // Notification auto-hide
  useEffect(() => {
    if (notification) {
      const timer = setTimeout(() => setNotification(null), 3000);
      return () => clearTimeout(timer);
    }
  }, [notification]);

  // Show Notification Helper
  const showNotification = useCallback((message, type = 'success') => {
    setNotification({ message, type });
  }, []);

  // Toggle Dark Mode
  const toggleDarkMode = useCallback(() => {
    setDarkMode(prev => !prev);
    showNotification(darkMode ? 'AydÄ±nlÄ±k mod aktif' : 'KaranlÄ±k mod aktif', 'success');
  }, [darkMode, showNotification]);

  // Veri Yedekleme (Backup)
  const backupData = useCallback(() => {
    const dataStr = JSON.stringify(calls, null, 2);
    const blob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `CallTrack_Backup_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
    showNotification('Veri yedeÄŸi baÅŸarÄ±yla indirildi!', 'success');
  }, [calls, showNotification]);

  // Veri Geri YÃ¼kleme (Restore)
  const restoreData = useCallback((event) => {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const data = JSON.parse(e.target.result);
        if (Array.isArray(data)) {
          setCalls(data);
          showNotification(`${data.length} kayÄ±t baÅŸarÄ±yla geri yÃ¼klendi!`, 'success');
        } else {
          showNotification('GeÃ§ersiz dosya formatÄ±!', 'error');
        }
      } catch (error) {
        showNotification('Dosya okuma hatasÄ±!', 'error');
      }
    };
    reader.readAsText(file);
  }, [showNotification]);

  // Excel'e Aktarma Fonksiyonu
  const exportToExcel = (dataToExport = calls, fileNamePrefix = "Tum_Arama_Kayitlari") => {
    if (dataToExport.length === 0) {
      alert("DÄ±ÅŸa aktarÄ±lacak kayÄ±t bulunamadÄ±.");
      return;
    }

    const headers = ["ID", "Tarih", "Saat", "Personel", "Firma AdÄ±", "SektÃ¶r", "Ä°l", "Ä°lÃ§e", "Ä°lgili KiÅŸi", "Unvan", "Telefon", "Yeni Telefon", "SonuÃ§", "Notlar"];
    
    const csvContent = [
      headers.join(";"), 
      ...dataToExport.map(call => [
        call.id,
        call.callDate,
        call.callTime,
        `"${call.caller || ''}"`,
        `"${call.companyName || ''}"`,
        `"${call.industry || ''}"`,
        `"${call.city || ''}"`,
        `"${call.district || ''}"`,
        `"${call.contactPerson || ''}"`,
        `"${call.contactTitle || ''}"`,
        `"${call.contactPhone || ''}"`,
        `"${call.newContactPhone || ''}"`,
        `"${call.result || ''}"`,
        `"${(call.notes || '').replace(/(\r\n|\n|\r)/gm, " ")}"`
      ].join(";"))
    ].join("\n");

    const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.setAttribute("href", url);
    link.setAttribute("download", `${fileNamePrefix}_${new Date().toLocaleDateString('tr-TR').replace(/\./g, '-')}.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  };

  // Form Ä°ÅŸlemleri
  const handleInputChange = (e) => {
    const { name, value } = e.target;
    
    if (name === 'city') {
      setFormData(prev => ({ 
        ...prev, 
        [name]: value,
        district: '' 
      }));
    } 
    // Telefon Formatlama Ä°ÅŸlemi
    else if (name === 'contactPhone' || name === 'newContactPhone') {
      const formatted = formatPhoneNumber(value);
      // Maksimum uzunluk kontrolÃ¼ (15 karakter: (555) 123 45 67)
      if (formatted.length <= 15) {
        setFormData(prev => ({ ...prev, [name]: formatted }));
      }
    }
    else {
      setFormData(prev => ({ ...prev, [name]: value }));
    }
  };

  const handleTimeChange = (type, value) => {
    setFormData(prev => {
      const [currentHour, currentMinute] = prev.callTime.split(':');
      let newTime;
      if (type === 'hour') {
        newTime = `${value}:${currentMinute}`;
      } else {
        newTime = `${currentHour}:${value}`;
      }
      return { ...prev, callTime: newTime };
    });
  };

  const handleSubmit = (e) => {
    e.preventDefault();

    // Validation
    if (!formData.caller || !formData.companyName || !formData.contactPerson) {
      showNotification('LÃ¼tfen tÃ¼m gerekli alanlarÄ± doldurunuz!', 'error');
      return;
    }

    if (editingId) {
      // DÃœZENLEME MODU
      setCalls(calls.map(call =>
        call.id === editingId ? { ...formData, id: editingId, createdAt: call.createdAt } : call
      ));
      showNotification('KayÄ±t baÅŸarÄ±yla gÃ¼ncellendi!', 'success');
      setEditingId(null);
    } else {
      // YENÄ° KAYIT MODU
      const newCall = {
        id: Date.now(),
        createdAt: new Date().toISOString(),
        ...formData
      };
      setCalls([newCall, ...calls]);
      showNotification('Arama kaydÄ± baÅŸarÄ±yla eklendi!', 'success');
    }

    // Formu sÄ±fÄ±rla
    setFormData({
      ...formData,
      companyName: '',
      contactPerson: '',
      contactTitle: '',
      contactPhone: '',
      newContactPhone: '',
      industry: '',
      city: '',
      district: '',
      result: 'GÃ¶rÃ¼ÅŸÃ¼ldÃ¼',
      notes: ''
    });
  };

  // DÃ¼zenleme BaÅŸlatma
  const handleEdit = (call) => {
    setFormData(call);
    setEditingId(call.id);
    setActiveTab('entry'); // Form sekmesine git
    window.scrollTo(0,0);
  };

  // DÃ¼zenleme Ä°ptal
  const handleCancelEdit = () => {
    setEditingId(null);
    setFormData({
      ...formData,
      companyName: '',
      contactPerson: '',
      contactTitle: '',
      contactPhone: '',
      newContactPhone: '',
      industry: '',
      city: '',
      district: '',
      result: 'GÃ¶rÃ¼ÅŸÃ¼ldÃ¼',
      notes: ''
    });
  };

  const handleDelete = (id) => {
    if (window.confirm("Bu kaydÄ± silmek istediÄŸinize emin misiniz?")) {
      setCalls(calls.filter(call => call.id !== id));
    }
  };

  // --- Filtreleme MantÄ±ÄŸÄ± ---
  const filteredCalls = useMemo(() => {
    let filtered = calls.filter(call => {
      const matchesSearch =
        (call.companyName?.toLowerCase() || '').includes(searchTerm.toLowerCase()) ||
        (call.contactPerson?.toLowerCase() || '').includes(searchTerm.toLowerCase()) ||
        (call.caller?.toLowerCase() || '').includes(searchTerm.toLowerCase()) ||
        (call.contactPhone?.toLowerCase() || '').includes(searchTerm.toLowerCase()) ||
        (call.newContactPhone?.toLowerCase() || '').includes(searchTerm.toLowerCase());

      const matchesResult = filterResult ? call.result === filterResult : true;
      const matchesCaller = filterCaller ? call.caller === filterCaller : true;
      const matchesCity = filterCity ? call.city === filterCity : true;

      // Date range filter
      let matchesDateRange = true;
      if (filterDateRange.start && filterDateRange.end) {
        const callDate = new Date(call.callDate);
        const startDate = new Date(filterDateRange.start);
        const endDate = new Date(filterDateRange.end);
        matchesDateRange = callDate >= startDate && callDate <= endDate;
      } else if (filterDateRange.start) {
        const callDate = new Date(call.callDate);
        const startDate = new Date(filterDateRange.start);
        matchesDateRange = callDate >= startDate;
      } else if (filterDateRange.end) {
        const callDate = new Date(call.callDate);
        const endDate = new Date(filterDateRange.end);
        matchesDateRange = callDate <= endDate;
      }

      return matchesSearch && matchesResult && matchesCaller && matchesCity && matchesDateRange;
    });

    // Reset to first page when filters change
    setCurrentPage(1);
    return filtered;
  }, [calls, searchTerm, filterResult, filterCaller, filterCity, filterDateRange]);

  // Paginated data
  const paginatedCalls = useMemo(() => {
    const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
    const endIndex = startIndex + ITEMS_PER_PAGE;
    return filteredCalls.slice(startIndex, endIndex);
  }, [filteredCalls, currentPage]);

  const totalPages = Math.ceil(filteredCalls.length / ITEMS_PER_PAGE);


  // --- Ä°statistik ve Rapor HesaplamalarÄ± ---
  const stats = useMemo(() => {
    const now = new Date();
    const todayStr = now.toISOString().split('T')[0];

    const dayOfWeek = now.getDay() || 7; 
    const startOfWeek = new Date(now);
    startOfWeek.setDate(now.getDate() - dayOfWeek + 1); 
    startOfWeek.setHours(0,0,0,0);

    const endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(startOfWeek.getDate() + 6); 
    endOfWeek.setHours(23,59,59,999);

    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
    const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);
    endOfMonth.setHours(23,59,59,999);

    const filterByRange = (start, end) => calls.filter(c => {
      const callDate = new Date(c.callDate);
      return callDate >= start && callDate <= end;
    });

    const weeklyCalls = filterByRange(startOfWeek, endOfWeek);
    const monthlyCalls = filterByRange(startOfMonth, endOfMonth);

    // HATIRLATMA MANTIÄI: BugÃ¼nÃ¼n tarihi ile eÅŸleÅŸen ve sonucu 'Tekrar Aranacak' veya 'Randevu AlÄ±ndÄ±' olanlar
    const todaysReminders = calls.filter(c => 
      c.callDate === todayStr && 
      (c.result === 'Tekrar Aranacak' || c.result === 'Randevu AlÄ±ndÄ±')
    );

    const industries = {};
    calls.forEach(c => {
      industries[c.industry] = (industries[c.industry] || 0) + 1;
    });

    const results = {};
    calls.forEach(c => {
      results[c.result] = (results[c.result] || 0) + 1;
    });

    return {
      total: calls.length,
      weeklyCount: weeklyCalls.length,
      monthlyCount: monthlyCalls.length,
      industries,
      results,
      weeklyList: weeklyCalls,
      monthlyList: monthlyCalls,
      todaysReminders, // Yeni: HatÄ±rlatmalar
      dateRanges: {
        weekStart: startOfWeek,
        weekEnd: endOfWeek,
        monthStart: startOfMonth,
        monthEnd: endOfMonth
      }
    };
  }, [calls]);

  // --- Alt BileÅŸenler ---

  // Notification Component
  const Notification = () => {
    if (!notification) return null;

    const bgColor = notification.type === 'success' ? 'bg-green-500' :
                    notification.type === 'error' ? 'bg-red-500' :
                    notification.type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';

    return (
      <div className="fixed top-4 right-4 z-50 animate-slide-in">
        <div className={`${bgColor} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3`}>
          {notification.type === 'success' && <CheckCircle size={20} />}
          {notification.type === 'error' && <XCircle size={20} />}
          {notification.type === 'warning' && <AlertTriangle size={20} />}
          <span className="font-medium">{notification.message}</span>
          <button onClick={() => setNotification(null)} className="ml-2">
            <X size={18} />
          </button>
        </div>
      </div>
    );
  };

  // Pagination Component
  const Pagination = ({ currentPage, totalPages, onPageChange }) => {
    if (totalPages <= 1) return null;

    const pages = [];
    const maxVisible = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
    let endPage = Math.min(totalPages, startPage + maxVisible - 1);

    if (endPage - startPage + 1 < maxVisible) {
      startPage = Math.max(1, endPage - maxVisible + 1);
    }

    for (let i = startPage; i <= endPage; i++) {
      pages.push(i);
    }

    return (
      <div className="flex items-center justify-center gap-2 mt-6">
        <button
          onClick={() => onPageChange(currentPage - 1)}
          disabled={currentPage === 1}
          className="p-2 rounded-lg border border-slate-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-100 transition"
        >
          <ChevronLeft size={20} />
        </button>

        {startPage > 1 && (
          <>
            <button onClick={() => onPageChange(1)} className="px-3 py-1 rounded-lg border border-slate-300 hover:bg-slate-100">
              1
            </button>
            {startPage > 2 && <span className="text-slate-400">...</span>}
          </>
        )}

        {pages.map(page => (
          <button
            key={page}
            onClick={() => onPageChange(page)}
            className={`px-3 py-1 rounded-lg border ${
              currentPage === page
                ? 'bg-blue-600 text-white border-blue-600'
                : 'border-slate-300 hover:bg-slate-100'
            }`}
          >
            {page}
          </button>
        ))}

        {endPage < totalPages && (
          <>
            {endPage < totalPages - 1 && <span className="text-slate-400">...</span>}
            <button onClick={() => onPageChange(totalPages)} className="px-3 py-1 rounded-lg border border-slate-300 hover:bg-slate-100">
              {totalPages}
            </button>
          </>
        )}

        <button
          onClick={() => onPageChange(currentPage + 1)}
          disabled={currentPage === totalPages}
          className="p-2 rounded-lg border border-slate-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-slate-100 transition"
        >
          <ChevronRight size={20} />
        </button>

        <span className="text-sm text-slate-600 ml-4">
          Sayfa {currentPage} / {totalPages}
        </span>
      </div>
    );
  };

  // HatÄ±rlatma Kutusu BileÅŸeni (Yeni)
  const ReminderBox = () => {
    if (stats.todaysReminders.length === 0) return null;

    return (
      <div className="bg-orange-50 border-l-4 border-orange-500 p-4 mb-6 rounded-r-lg shadow-sm animate-pulse-slow">
        <div className="flex items-start gap-3">
          <AlertTriangle className="text-orange-600 mt-1" size={24} />
          <div className="flex-1">
            <h3 className="font-bold text-orange-800 text-lg">GÃ¼nÃ¼n HatÄ±rlatmalarÄ± ({stats.todaysReminders.length})</h3>
            <p className="text-sm text-orange-700 mb-3">
              BugÃ¼n iÅŸlem yapÄ±lan ve takip gerektiren kayÄ±tlar:
            </p>
            <div className="space-y-2">
              {stats.todaysReminders.map(call => (
                <div key={call.id} className="bg-white p-3 rounded border border-orange-200 flex justify-between items-center text-sm">
                  <div>
                    <span className="font-bold text-slate-700">{call.companyName}</span> 
                    <span className="mx-2 text-slate-400">|</span> 
                    <span className="text-slate-600">{call.contactPerson}</span>
                  </div>
                  <Badge type="warning">{call.result}</Badge>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );
  };

  const EntryForm = () => (
    <div className="max-w-4xl mx-auto">
      <ReminderBox /> {/* HatÄ±rlatma Kutusu Eklendi */}

      <div className="mb-6 animate-fade-in">
        <h2 className={`text-2xl font-bold flex items-center gap-2 ${darkMode ? 'text-white' : 'text-slate-800'}`}>
          {editingId ? <Edit size={24} className="text-orange-500" /> : <CheckCircle size={24} className="text-blue-500" />}
          {editingId ? "KaydÄ± DÃ¼zenle" : "Yeni Arama KaydÄ±"}
        </h2>
        <p className={darkMode ? 'text-slate-400' : 'text-slate-500'}>
          {editingId ? "Mevcut kayÄ±ttaki bilgileri gÃ¼ncelleyiniz." : "GÃ¶rÃ¼ÅŸme detaylarÄ±nÄ± eksiksiz doldurunuz."}
        </p>
      </div>

      <div className={`p-6 rounded-xl shadow-lg border-t-4 border-t-blue-500 transition-all duration-300 ${
        darkMode
          ? 'glass-dark border-l border-r border-b border-slate-700'
          : 'glass border-l border-r border-b border-white/30'
      }`}>
        <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 gap-6">
          
          {/* PERSONEL SEÃ‡Ä°MÄ° */}
          <div className={`md:col-span-2 p-4 rounded-lg border transition-colors ${
            darkMode
              ? 'bg-blue-900/20 border-blue-700/50'
              : 'bg-blue-50 border-blue-100'
          }`}>
            <label className={`block text-sm font-bold mb-2 flex items-center gap-2 ${
              darkMode ? 'text-blue-400' : 'text-blue-800'
            }`}>
              <UserCircle size={20} /> AramayÄ± Yapan Personel
            </label>
            <select
              required
              name="caller"
              value={formData.caller}
              onChange={handleInputChange}
              className={`w-full p-3 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none font-medium transition-colors ${
                darkMode
                  ? 'bg-slate-800/50 border border-slate-600 text-white'
                  : 'bg-white border border-blue-200 text-blue-900'
              }`}
            >
              <option value="">Personel SeÃ§iniz...</option>
              {CALLERS.sort().map(caller => (
                <option key={caller} value={caller}>{caller}</option>
              ))}
            </select>
          </div>

          {/* Firma Bilgileri */}
          <div className="space-y-4">
            <h3 className={`text-lg font-semibold flex items-center gap-2 ${
              darkMode ? 'text-blue-400' : 'text-blue-600'
            }`}>
              <Building size={20} /> Firma Bilgileri
            </h3>

            <div>
              <label className={`block text-sm font-medium mb-1 ${
                darkMode ? 'text-slate-300' : 'text-slate-700'
              }`}>Firma AdÄ±</label>
              <input
                required
                type="text"
                name="companyName"
                value={formData.companyName}
                onChange={handleInputChange}
                className={`w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${
                  darkMode
                    ? 'bg-slate-800/50 border border-slate-600 text-white placeholder-slate-500'
                    : 'bg-white border border-slate-300 text-slate-900 placeholder-slate-400'
                }`}
                placeholder="Ã–rn: ABC Lojistik A.Å."
              />
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className={`block text-sm font-medium mb-1 ${
                  darkMode ? 'text-slate-300' : 'text-slate-700'
                }`}>SektÃ¶r</label>
                <select
                  required
                  name="industry"
                  value={formData.industry}
                  onChange={handleInputChange}
                  className={`w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${
                    darkMode
                      ? 'bg-slate-800/50 border border-slate-600 text-white'
                      : 'bg-white border border-slate-300 text-slate-900'
                  }`}
                >
                  <option value="">SeÃ§iniz...</option>
                  <option value="Teknoloji">Teknoloji & YazÄ±lÄ±m</option>
                  <option value="Ä°nÅŸaat">Ä°nÅŸaat & YapÄ±</option>
                  <option value="Lojistik">Lojistik & UlaÅŸÄ±m</option>
                  <option value="SaÄŸlÄ±k">SaÄŸlÄ±k & Medikal</option>
                  <option value="Perakende">Perakende & MaÄŸazacÄ±lÄ±k</option>
                  <option value="Ãœretim">Ãœretim & Sanayi</option>
                  <option value="Finans">Finans & BankacÄ±lÄ±k</option>
                  <option value="EÄŸitim">EÄŸitim & Akademi</option>
                  <option value="Turizm">Turizm & Otelcilik</option>
                  <option value="Otomotiv">Otomotiv</option>
                  <option value="Enerji">Enerji & Madencilik</option>
                  <option value="Tekstil">Tekstil & Moda</option>
                  <option value="Gayrimenkul">Gayrimenkul</option>
                  <option value="GÄ±da">GÄ±da & Ä°Ã§ecek</option>
                  <option value="DanÄ±ÅŸmanlÄ±k">DanÄ±ÅŸmanlÄ±k</option>
                  <option value="Medya">Medya & Reklam</option>
                  <option value="TelekomÃ¼nikasyon">TelekomÃ¼nikasyon</option>
                  <option value="TarÄ±m">TarÄ±m & HayvancÄ±lÄ±k</option>
                  <option value="Kimya">Kimya & Kozmetik</option>
                  <option value="Mobilya">Mobilya & Dekorasyon</option>
                  <option value="Hukuk">Hukuk</option>
                  <option value="Ä°thalat">Ä°thalat & Ä°hracat</option>
                  <option value="Hizmet">Hizmet SektÃ¶rÃ¼</option>
                  <option value="DiÄŸer">DiÄŸer</option>
                </select>
              </div>
              <div>
                <label className={`block text-sm font-medium mb-1 ${
                  darkMode ? 'text-slate-300' : 'text-slate-700'
                }`}>Tarih</label>
                <input
                  required
                  type="date"
                  name="callDate"
                  value={formData.callDate}
                  onChange={handleInputChange}
                  className={`w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${
                    darkMode
                      ? 'bg-slate-800/50 border border-slate-600 text-white'
                      : 'bg-white border border-slate-300 text-slate-900'
                  }`}
                />
              </div>
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className={`block text-sm font-medium mb-1 ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>Ä°l</label>
                <select
                  required
                  name="city"
                  value={formData.city}
                  onChange={handleInputChange}
                  className={`w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${darkMode ? 'bg-slate-800/50 border border-slate-600 text-white' : 'bg-white border border-slate-300 text-slate-900'}`}
                >
                  <option value="">Ä°l SeÃ§iniz</option>
                  {Object.keys(CITIES_DATA)
                    .sort((a, b) => a.localeCompare(b, 'tr'))
                    .map(city => (
                      <option key={city} value={city}>{city}</option>
                  ))}
                </select>
              </div>
              <div>
                <label className={`block text-sm font-medium mb-1 ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>Ä°lÃ§e</label>
                <select
                  required
                  name="district"
                  value={formData.district}
                  onChange={handleInputChange}
                  disabled={!formData.city}
                  className={`w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${
                    darkMode
                      ? 'bg-slate-800/50 border border-slate-600 text-white disabled:bg-slate-900/30 disabled:text-slate-600'
                      : 'bg-white border border-slate-300 text-slate-900 disabled:bg-slate-100 disabled:text-slate-400'
                  }`}
                >
                  <option value="">Ä°lÃ§e SeÃ§iniz</option>
                  {formData.city && 
                    [...CITIES_DATA[formData.city]]
                      .sort((a, b) => a.localeCompare(b, 'tr'))
                      .map(dist => (
                        <option key={dist} value={dist}>{dist}</option>
                  ))}
                </select>
              </div>
            </div>
          </div>

          {/* KiÅŸi ve SonuÃ§ Bilgileri */}
          <div className="space-y-4">
            <h3 className={`text-lg font-semibold flex items-center gap-2 ${darkMode ? 'text-blue-400' : 'text-blue-600'}`}>
              <User size={20} /> Ä°letiÅŸim & SonuÃ§
            </h3>

            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className={`block text-sm font-medium mb-1 ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>GÃ¶rÃ¼ÅŸÃ¼len KiÅŸi</label>
                <input 
                  required
                  type="text" 
                  name="contactPerson"
                  value={formData.contactPerson}
                  onChange={handleInputChange}
                  className={`w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${darkMode ? 'bg-slate-800/50 border border-slate-600 text-white placeholder-slate-500' : 'bg-white border border-slate-300 text-slate-900 placeholder-slate-400'}`}
                  placeholder="Ahmet YÄ±lmaz"
                />
              </div>
              <div>
                <label className={`block text-sm font-medium mb-1 ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>Unvan</label>
                <input 
                  required
                  type="text" 
                  name="contactTitle"
                  value={formData.contactTitle}
                  onChange={handleInputChange}
                  className={`w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${darkMode ? 'bg-slate-800/50 border border-slate-600 text-white placeholder-slate-500' : 'bg-white border border-slate-300 text-slate-900 placeholder-slate-400'}`}
                  placeholder="SatÄ±n Alma MÃ¼dÃ¼rÃ¼"
                />
              </div>
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className={`block text-sm font-medium mb-1 ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>Aranan Numara</label>
                <input 
                  required
                  type="text" 
                  name="contactPhone"
                  value={formData.contactPhone}
                  onChange={handleInputChange}
                  className={`w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${darkMode ? 'bg-slate-800/50 border border-slate-600 text-white placeholder-slate-500' : 'bg-white border border-slate-300 text-slate-900 placeholder-slate-400'}`}
                  placeholder="(555) 123 45 67"
                />
              </div>
              <div>
                <label className={`block text-sm font-medium mb-1 ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>AlÄ±nan Yeni Numara (Varsa)</label>
                <input 
                  type="text" 
                  name="newContactPhone"
                  value={formData.newContactPhone}
                  onChange={handleInputChange}
                  className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none"
                  placeholder="(5XX) XXX XX XX"
                />
              </div>
            </div>

            <div>
              <label className={`block text-sm font-medium mb-1 ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>GÃ¶rÃ¼ÅŸme Saati (09:00 - 18:00)</label>
              <div className="grid grid-cols-2 gap-2">
                <select
                  value={formData.callTime.split(':')[0]}
                  onChange={(e) => handleTimeChange('hour', e.target.value)}
                  className={`w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${darkMode ? 'bg-slate-800/50 border border-slate-600 text-white placeholder-slate-500' : 'bg-white border border-slate-300 text-slate-900 placeholder-slate-400'}`}
                >
                  {HOURS.map(h => (
                    <option key={h} value={h}>{h}</option>
                  ))}
                </select>
                
                <select
                  value={formData.callTime.split(':')[1]}
                  onChange={(e) => handleTimeChange('minute', e.target.value)}
                  className={`w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${darkMode ? 'bg-slate-800/50 border border-slate-600 text-white placeholder-slate-500' : 'bg-white border border-slate-300 text-slate-900 placeholder-slate-400'}`}
                >
                  {MINUTES.map(m => (
                    <option key={m} value={m}>{m}</option>
                  ))}
                </select>
              </div>
              <p className="text-xs text-slate-400 mt-1">Sadece mesai saatleri seÃ§ilebilir.</p>
            </div>

            <div>
              <label className={`block text-sm font-medium mb-1 ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>GÃ¶rÃ¼ÅŸme Sonucu</label>
              <select 
                required
                name="result"
                value={formData.result}
                onChange={handleInputChange}
                className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
              >
                <option value="GÃ¶rÃ¼ÅŸÃ¼ldÃ¼">âœ… GÃ¶rÃ¼ÅŸÃ¼ldÃ¼ (Olumlu)</option>
                <option value="Mail Ä°stedi">ğŸ“§ Mail Ä°stedi</option>
                <option value="Randevu AlÄ±ndÄ±">ğŸ“… Randevu AlÄ±ndÄ±</option>
                <option value="Teklif Bekliyor">ğŸ“„ Teklif Bekliyor</option>
                <option value="Yetkiliye Ä°letildi">ğŸ—£ï¸ Yetkiliye Ä°letildi</option>
                <option value="Tekrar Aranacak">ğŸ”„ Tekrar Aranacak</option>
                <option value="UlaÅŸÄ±lamadÄ±">ğŸ“ UlaÅŸÄ±lamadÄ±</option>
                <option value="Reddedildi">âŒ Reddedildi (Olumsuz)</option>
                <option value="YanlÄ±ÅŸ Numara">ğŸš« YanlÄ±ÅŸ Numara</option>
              </select>
            </div>

            <div>
              <label className={`block text-sm font-medium mb-1 ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>Notlar</label>
              <textarea
                name="notes"
                value={formData.notes}
                onChange={handleInputChange}
                rows="2"
                className={`w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${
                  darkMode
                    ? 'bg-slate-800/50 border border-slate-600 text-white placeholder-slate-500'
                    : 'bg-white border border-slate-300 text-slate-900 placeholder-slate-400'
                }`}
                placeholder="Ã–zel notlar..."
              ></textarea>
            </div>
          </div>

          <div className="md:col-span-2 mt-4 flex gap-4">
            <button 
              type="submit" 
              className={`flex-1 font-bold py-3 px-6 rounded-lg transition duration-200 flex items-center justify-center gap-2 text-white ${editingId ? 'bg-orange-500 hover:bg-orange-600' : 'bg-blue-600 hover:bg-blue-700'}`}
            >
              {editingId ? <Edit size={20} /> : <CheckCircle size={20} />}
              {editingId ? "DeÄŸiÅŸiklikleri Kaydet" : "KaydÄ± Tamamla"}
            </button>
            
            {editingId && (
              <button
                type="button"
                onClick={handleCancelEdit}
                className={`font-bold py-3 px-6 rounded-lg transition duration-200 flex items-center justify-center gap-2 ${
                  darkMode
                    ? 'bg-slate-700 hover:bg-slate-600 text-white'
                    : 'bg-slate-200 hover:bg-slate-300 text-slate-700'
                }`}
              >
                <X size={20} /> Ä°ptal
              </button>
            )}
          </div>
        </form>
      </div>
    </div>
  );

  const CallsTable = ({ data, title, onDownload, showActions = true, showPagination = false, darkMode = false }) => (
    <div className="space-y-4">
       <div className="flex justify-between items-center">
        <h2 className={`text-xl font-bold flex items-center gap-2 ${darkMode ? 'text-white' : 'text-slate-800'}`}>
          {title}
        </h2>
        <div className="flex items-center gap-4">
          <span className={`text-sm hidden md:inline ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>
            Toplam {filteredCalls.length} kayÄ±t
            {showPagination && totalPages > 1 && ` (Sayfa ${currentPage}/${totalPages})`}
          </span>
          {onDownload && (
            <button
              onClick={onDownload}
              className="bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors shadow-lg hover:shadow-xl"
            >
              <Download size={14} /> Excel Ä°ndir
            </button>
          )}
        </div>
      </div>

      <div className={`rounded-xl shadow-lg overflow-hidden transition-all duration-300 ${
        darkMode
          ? 'glass-dark border border-slate-700'
          : 'glass border border-white/30'
      }`}>
        <div className="overflow-x-auto">
          <table className="w-full text-sm text-left">
            <thead className={`font-semibold border-b transition-colors ${
              darkMode
                ? 'bg-slate-800/50 text-slate-300 border-slate-700'
                : 'bg-slate-50 text-slate-700 border-slate-200'
            }`}>
              <tr>
                <th className="p-4">Tarih/Saat</th>
                <th className="p-4">Personel</th>
                <th className="p-4">Firma</th>
                <th className="p-4">Ä°lgili KiÅŸi</th>
                <th className="p-4">Telefon</th>
                <th className="p-4">Konum</th>
                <th className="p-4">SektÃ¶r</th>
                <th className="p-4">SonuÃ§</th>
                {showActions && <th className="p-4 text-right">Ä°ÅŸlem</th>}
              </tr>
            </thead>
            <tbody className={`divide-y ${darkMode ? 'divide-slate-700' : 'divide-slate-100'}`}>
              {data.length === 0 ? (
                <tr>
                  <td colSpan={showActions ? "9" : "8"} className={`p-8 text-center ${darkMode ? 'text-slate-500' : 'text-slate-400'}`}>
                    KayÄ±t bulunmamaktadÄ±r.
                  </td>
                </tr>
              ) : (
                data.map((call) => (
                  <tr key={call.id} className={`transition-colors ${
                    darkMode ? 'hover:bg-slate-700/30' : 'hover:bg-slate-50'
                  }`}>
                    <td className="p-4 whitespace-nowrap">
                      <div className={`font-medium ${darkMode ? 'text-white' : 'text-slate-900'}`}>{call.callDate}</div>
                      <div className={`text-xs ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>{call.callTime}</div>
                    </td>
                    <td className={`p-4 font-bold ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>{call.caller || "-"}</td>
                    <td className="p-4 font-medium text-blue-500">{call.companyName}</td>
                    <td className="p-4">
                      <div className={darkMode ? 'text-white' : 'text-slate-900'}>{call.contactPerson}</div>
                      <div className={`text-xs ${darkMode ? 'text-slate-400' : 'text-slate-500'}`}>{call.contactTitle}</div>
                    </td>
                    <td className="p-4">
                       <div className={`text-xs flex items-center gap-1 ${darkMode ? 'text-white' : 'text-slate-900'}`}>
                          <Phone size={12} className={darkMode ? 'text-slate-500' : 'text-slate-400'}/> {call.contactPhone || "-"}
                       </div>
                       {call.newContactPhone && (
                         <div className="text-green-500 text-xs font-semibold flex items-center gap-1 mt-1">
                            <Smartphone size={12} /> {call.newContactPhone}
                         </div>
                       )}
                    </td>
                    <td className={`p-4 ${darkMode ? 'text-slate-300' : 'text-slate-600'}`}>{call.city} / {call.district}</td>
                    <td className="p-4">
                      <span className={`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${
                        darkMode ? 'bg-slate-700 text-slate-300' : 'bg-slate-100 text-slate-800'
                      }`}>
                        {call.industry}
                      </span>
                    </td>
                    <td className="p-4">
                      <Badge type={
                        call.result.includes('Olumlu') || call.result.includes('Randevu') || call.result.includes('Teklif') || call.result.includes('Mail') ? 'success' :
                        call.result.includes('Reddedildi') || call.result.includes('YanlÄ±ÅŸ') ? 'danger' : 'warning'
                      }>
                        {call.result}
                      </Badge>
                      {call.notes && (
                         <div className="text-xs text-slate-400 mt-1 max-w-[150px] truncate">{call.notes}</div>
                      )}
                    </td>
                    {showActions && (
                      <td className="p-4 text-right">
                        <div className="flex justify-end gap-2">
                          <button 
                            onClick={() => handleEdit(call)}
                            className="text-slate-400 hover:text-blue-500 p-1"
                            title="DÃ¼zenle"
                          >
                            <Edit size={16} />
                          </button>
                          <button 
                            onClick={() => handleDelete(call.id)}
                            className="text-slate-400 hover:text-red-500 p-1"
                            title="Sil"
                          >
                            <Trash2 size={16} />
                          </button>
                        </div>
                      </td>
                    )}
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>
      {showPagination && <Pagination currentPage={currentPage} totalPages={totalPages} onPageChange={setCurrentPage} />}
    </div>
  );

  const ReportsView = () => {
    // Tarih FormatlayÄ±cÄ± (GG.AA.YYYY)
    const formatDate = (date) => date.toLocaleDateString('tr-TR');

    const weekTitle = `HaftalÄ±k Rapor (${formatDate(stats.dateRanges.weekStart)} - ${formatDate(stats.dateRanges.weekEnd)})`;
    const monthTitle = `AylÄ±k Rapor (${formatDate(stats.dateRanges.monthStart)} - ${formatDate(stats.dateRanges.monthEnd)})`;

    // Personel performansÄ±
    const staffPerformance = useMemo(() => {
      const performance = {};
      calls.forEach(call => {
        if (!performance[call.caller]) {
          performance[call.caller] = {
            total: 0,
            successful: 0,
            pending: 0,
            failed: 0
          };
        }
        performance[call.caller].total++;

        if (['GÃ¶rÃ¼ÅŸÃ¼ldÃ¼', 'Randevu AlÄ±ndÄ±', 'Teklif Bekliyor', 'Mail Ä°stedi'].includes(call.result)) {
          performance[call.caller].successful++;
        } else if (['Reddedildi', 'YanlÄ±ÅŸ Numara'].includes(call.result)) {
          performance[call.caller].failed++;
        } else {
          performance[call.caller].pending++;
        }
      });
      return performance;
    }, [calls]);

    return (
      <div className="max-w-6xl mx-auto space-y-8">
        <div className="flex justify-between items-center bg-gradient-to-r from-slate-800 to-slate-700 text-white p-6 rounded-xl shadow-lg">
          <div>
            <h2 className="text-2xl font-bold flex items-center gap-2">
              <Activity className="text-blue-400" size={28} />
              YÃ¶netici Paneli
            </h2>
            <p className="text-slate-300">Genel performans Ã¶zeti ve detaylÄ± raporlar</p>
          </div>
          <div className="text-right">
            <div className="flex items-center gap-4">
              <button
                onClick={() => exportToExcel(calls, "Tum_Arama_Kayitlari")}
                className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors border border-green-500 shadow-md"
              >
                <Download size={16} /> TÃ¼mÃ¼nÃ¼ Ä°ndir
              </button>
              <div className="text-right bg-slate-900/50 px-4 py-2 rounded-lg">
                <div className="text-3xl font-bold">{stats.total}</div>
                <div className="text-sm text-slate-400">Toplam Arama</div>
              </div>
            </div>
          </div>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          <Card className="p-6 border-l-4 border-blue-500">
            <div className="text-slate-500 text-sm font-medium mb-1">Bu Hafta ({formatDate(stats.dateRanges.weekStart)} - ...)</div>
            <div className="text-3xl font-bold text-slate-800">{stats.weeklyCount}</div>
            <div className="text-xs text-green-600 mt-2 font-medium">Bu hafta girilen kayÄ±tlar</div>
          </Card>
          <Card className="p-6 border-l-4 border-indigo-500">
            <div className="text-slate-500 text-sm font-medium mb-1">Bu Ay ({formatDate(stats.dateRanges.monthStart)} - ...)</div>
            <div className="text-3xl font-bold text-slate-800">{stats.monthlyCount}</div>
            <div className="text-xs text-green-600 mt-2 font-medium">Bu ay girilen kayÄ±tlar</div>
          </Card>
          <Card className="p-6 border-l-4 border-green-500">
            <div className="text-slate-500 text-sm font-medium mb-1">Verimlilik</div>
            <div className="text-3xl font-bold text-slate-800">
              {stats.total > 0 
                ? Math.round(((stats.results['GÃ¶rÃ¼ÅŸÃ¼ldÃ¼'] || 0) + (stats.results['Teklif Bekliyor'] || 0) + (stats.results['Randevu AlÄ±ndÄ±'] || 0) + (stats.results['Mail Ä°stedi'] || 0)) / stats.total * 100)
                : 0}%
            </div>
            <div className="text-xs text-slate-400 mt-2 font-medium">Olumlu SonuÃ§ OranÄ±</div>
          </Card>
        </div>

        {/* Staff Performance Section */}
        <Card className="p-6">
          <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
            <Target size={20} className="text-purple-500" /> Personel PerformansÄ±
          </h3>
          <div className="overflow-x-auto">
            <table className="w-full text-sm">
              <thead className="bg-slate-50">
                <tr>
                  <th className="p-3 text-left">Personel</th>
                  <th className="p-3 text-center">Toplam</th>
                  <th className="p-3 text-center">BaÅŸarÄ±lÄ±</th>
                  <th className="p-3 text-center">Beklemede</th>
                  <th className="p-3 text-center">BaÅŸarÄ±sÄ±z</th>
                  <th className="p-3 text-center">Oran</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-slate-100">
                {Object.entries(staffPerformance)
                  .sort((a, b) => b[1].total - a[1].total)
                  .map(([name, data]) => (
                    <tr key={name} className="hover:bg-slate-50">
                      <td className="p-3 font-medium text-slate-700">{name}</td>
                      <td className="p-3 text-center font-bold">{data.total}</td>
                      <td className="p-3 text-center">
                        <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-700">
                          {data.successful}
                        </span>
                      </td>
                      <td className="p-3 text-center">
                        <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-700">
                          {data.pending}
                        </span>
                      </td>
                      <td className="p-3 text-center">
                        <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-700">
                          {data.failed}
                        </span>
                      </td>
                      <td className="p-3 text-center font-bold text-blue-600">
                        {data.total > 0 ? Math.round((data.successful / data.total) * 100) : 0}%
                      </td>
                    </tr>
                  ))}
              </tbody>
            </table>
          </div>
        </Card>

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <Card className="p-6">
            <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
              <PieChart size={20} className="text-blue-500" /> SektÃ¶r DaÄŸÄ±lÄ±mÄ±
            </h3>
            <div className="space-y-3">
              {Object.entries(stats.industries).map(([name, count]) => (
                <div key={name}>
                  <div className="flex justify-between text-sm mb-1">
                    <span className="text-slate-700">{name || "BelirtilmemiÅŸ"}</span>
                    <span className="font-medium text-slate-900">{count}</span>
                  </div>
                  <div className="w-full bg-slate-100 rounded-full h-2">
                    <div 
                      className="bg-blue-500 h-2 rounded-full" 
                      style={{ width: `${(count / stats.total) * 100}%` }}
                    ></div>
                  </div>
                </div>
              ))}
            </div>
          </Card>

          <Card className="p-6">
            <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
              <FileText size={20} className="text-indigo-500" /> SonuÃ§ Analizi
            </h3>
            <div className="space-y-4">
              {Object.entries(stats.results).map(([name, count]) => (
                <div key={name} className="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                    <div className="flex items-center gap-2">
                      <div className={`w-3 h-3 rounded-full ${
                        name.includes('Reddedildi') || name.includes('YanlÄ±ÅŸ') ? 'bg-red-500' :
                        name.includes('UlaÅŸÄ±lamadÄ±') || name.includes('Tekrar') || name.includes('Yetkiliye') ? 'bg-yellow-500' : 'bg-green-500'
                      }`}></div>
                      <span className="text-sm font-medium text-slate-700">{name}</span>
                    </div>
                    <span className="font-bold text-slate-800">{count}</span>
                </div>
              ))}
            </div>
          </Card>
        </div>

        <div className="space-y-6">
          <CallsTable
            data={stats.weeklyList}
            title={weekTitle}
            showActions={false} // Raporda dÃ¼zenleme butonlarÄ±nÄ± gizle
            onDownload={() => exportToExcel(stats.weeklyList, `Haftalik_Rapor_${formatDate(stats.dateRanges.weekStart)}_${formatDate(stats.dateRanges.weekEnd)}`)}
            darkMode={darkMode}
          />
          <CallsTable
            data={stats.monthlyList}
            title={monthTitle}
            showActions={false} // Raporda dÃ¼zenleme butonlarÄ±nÄ± gizle
            onDownload={() => exportToExcel(stats.monthlyList, `Aylik_Rapor_${formatDate(stats.dateRanges.monthStart)}_${formatDate(stats.dateRanges.monthEnd)}`)}
            darkMode={darkMode}
          />
        </div>
      </div>
    );
  };

  // --- Render ---

  return (
    <div className={`min-h-screen font-sans flex transition-colors duration-500 ${
      darkMode
        ? 'bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white'
        : 'bg-gradient-to-br from-slate-50 via-blue-50 to-slate-50 text-slate-900'
    }`}>
      <Notification />
      {/* Yan MenÃ¼ (Sidebar) */}
      <aside className="w-64 bg-slate-900 text-white hidden md:flex flex-col fixed h-full shadow-xl z-10">
        <div className="p-6 border-b border-slate-800">
          <h1 className="text-xl font-bold tracking-wider flex items-center gap-2">
            <Phone className="text-blue-400" />
            CALL<span className="text-blue-400">TRACK</span>
          </h1>
          <p className="text-xs text-slate-500 mt-1">Kurumsal Takip Sistemi</p>
        </div>
        
        <nav className="flex-1 p-4 space-y-2">
          <button
            onClick={() => { setActiveTab('entry'); setEditingId(null); handleCancelEdit(); }}
            className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeTab === 'entry' ? 'bg-blue-600 text-white' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}
          >
            <CheckCircle size={20} /> Arama GiriÅŸi
          </button>

          <button
            onClick={() => setActiveTab('list')}
            className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeTab === 'list' ? 'bg-blue-600 text-white' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}
          >
            <List size={20} /> TÃ¼m KayÄ±tlar
          </button>

          <button
            onClick={() => setActiveTab('reports')}
            className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeTab === 'reports' ? 'bg-blue-600 text-white' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}
          >
            <BarChart3 size={20} /> Raporlar & Patron
          </button>

          <div className="pt-4 mt-4 border-t border-slate-800">
            <p className="text-xs text-slate-500 mb-2 px-2">Veri YÃ¶netimi</p>
            <button
              onClick={backupData}
              className="w-full flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-colors text-sm"
            >
              <Save size={18} /> Yedek Al
            </button>
            <label className="w-full flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-colors text-sm cursor-pointer">
              <Upload size={18} /> Yedek YÃ¼kle
              <input
                type="file"
                accept=".json"
                onChange={restoreData}
                className="hidden"
              />
            </label>
          </div>

          <div className="pt-4 mt-4 border-t border-slate-800">
            <p className="text-xs text-slate-500 mb-2 px-2">GÃ¶rÃ¼nÃ¼m</p>
            <button
              onClick={toggleDarkMode}
              className="w-full flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-colors text-sm"
            >
              {darkMode ? <Sun size={18} /> : <Moon size={18} />}
              {darkMode ? 'AydÄ±nlÄ±k Mod' : 'KaranlÄ±k Mod'}
            </button>
            <button
              onClick={() => setViewMode(viewMode === 'list' ? 'grid' : 'list')}
              className="w-full flex items-center gap-3 px-4 py-2 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white transition-colors text-sm"
            >
              {viewMode === 'list' ? <LayoutGrid size={18} /> : <List size={18} />}
              {viewMode === 'list' ? 'Izgara GÃ¶rÃ¼nÃ¼m' : 'Liste GÃ¶rÃ¼nÃ¼m'}
            </button>
          </div>
        </nav>

        <div className="p-4 border-t border-slate-800 text-xs text-slate-500 text-center">
          <div className="flex items-center justify-center gap-2 mb-2">
            <Sparkles size={12} className="text-blue-400" />
            <span className="font-semibold text-white">v2.0.0</span>
          </div>
          <p className="text-xs">Modern Edition</p>
        </div>
      </aside>

      {/* Mobil MenÃ¼ BaÅŸlÄ±ÄŸÄ± */}
      <div className="md:hidden fixed top-0 w-full bg-slate-900 text-white p-4 z-20 flex justify-between items-center">
         <span className="font-bold">CallTrack</span>
         <div className="flex gap-4">
            <button onClick={() => setActiveTab('entry')}><CheckCircle size={24}/></button>
            <button onClick={() => setActiveTab('list')}><List size={24}/></button>
            <button onClick={() => setActiveTab('reports')}><BarChart3 size={24}/></button>
         </div>
      </div>

      {/* Ana Ä°Ã§erik AlanÄ± */}
      <main className={`flex-1 md:ml-64 p-6 md:p-10 pt-20 md:pt-10 pb-48 transition-all ${darkMode ? 'text-white' : 'text-slate-900'}`}>
        {activeTab === 'entry' && <EntryForm />}
        {activeTab === 'list' && (
          <div className="space-y-6">
            {/* ARAMA VE FÄ°LTRELEME ALANI */}
            <div className={`p-4 rounded-xl shadow-lg transition-all duration-300 ${
              darkMode
                ? 'glass-dark border border-slate-700'
                : 'glass border border-white/30 shadow-xl'
            }`}>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <Search size={18} className="text-slate-400" />
                  </div>
                  <input
                    type="text"
                    placeholder="Firma, KiÅŸi, Telefon Ara..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className={`pl-10 w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${
                      darkMode
                        ? 'bg-slate-800/50 border border-slate-600 text-white placeholder-slate-400'
                        : 'bg-white/50 border border-slate-300 text-slate-900 placeholder-slate-500'
                    }`}
                  />
                </div>

                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <Filter size={18} className="text-slate-400" />
                  </div>
                  <select
                    value={filterResult}
                    onChange={(e) => setFilterResult(e.target.value)}
                    className={`pl-10 w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${
                      darkMode
                        ? 'bg-slate-800/50 border border-slate-600 text-white'
                        : 'bg-white/50 border border-slate-300 text-slate-900'
                    }`}
                  >
                    <option value="">TÃ¼m SonuÃ§lar</option>
                    <option value="GÃ¶rÃ¼ÅŸÃ¼ldÃ¼">âœ… GÃ¶rÃ¼ÅŸÃ¼ldÃ¼</option>
                    <option value="Mail Ä°stedi">ğŸ“§ Mail Ä°stedi</option>
                    <option value="Randevu AlÄ±ndÄ±">ğŸ“… Randevu AlÄ±ndÄ±</option>
                    <option value="Teklif Bekliyor">ğŸ“„ Teklif Bekliyor</option>
                    <option value="Yetkiliye Ä°letildi">ğŸ—£ï¸ Yetkiliye Ä°letildi</option>
                    <option value="Tekrar Aranacak">ğŸ”„ Tekrar Aranacak</option>
                    <option value="UlaÅŸÄ±lamadÄ±">ğŸ“ UlaÅŸÄ±lamadÄ±</option>
                    <option value="Reddedildi">âŒ Reddedildi</option>
                    <option value="YanlÄ±ÅŸ Numara">ğŸš« YanlÄ±ÅŸ Numara</option>
                  </select>
                </div>

                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <UserCircle size={18} className="text-slate-400" />
                  </div>
                  <select
                    value={filterCaller}
                    onChange={(e) => setFilterCaller(e.target.value)}
                    className={`pl-10 w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${
                      darkMode
                        ? 'bg-slate-800/50 border border-slate-600 text-white'
                        : 'bg-white/50 border border-slate-300 text-slate-900'
                    }`}
                  >
                    <option value="">TÃ¼m Personeller</option>
                    {CALLERS.map(caller => (
                      <option key={caller} value={caller}>{caller}</option>
                    ))}
                  </select>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <MapPin size={18} className="text-slate-400" />
                  </div>
                  <select
                    value={filterCity}
                    onChange={(e) => setFilterCity(e.target.value)}
                    className={`pl-10 w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${
                      darkMode
                        ? 'bg-slate-800/50 border border-slate-600 text-white'
                        : 'bg-white/50 border border-slate-300 text-slate-900'
                    }`}
                  >
                    <option value="">TÃ¼m Ä°ller</option>
                    {Object.keys(CITIES_DATA).sort((a, b) => a.localeCompare(b, 'tr')).map(city => (
                      <option key={city} value={city}>{city}</option>
                    ))}
                  </select>
                </div>

                <div>
                  <input
                    type="date"
                    value={filterDateRange.start}
                    onChange={(e) => setFilterDateRange(prev => ({ ...prev, start: e.target.value }))}
                    className={`w-full p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${
                      darkMode
                        ? 'bg-slate-800/50 border border-slate-600 text-white'
                        : 'bg-white/50 border border-slate-300 text-slate-900'
                    }`}
                    placeholder="BaÅŸlangÄ±Ã§ Tarihi"
                  />
                </div>

                <div className="flex gap-2">
                  <input
                    type="date"
                    value={filterDateRange.end}
                    onChange={(e) => setFilterDateRange(prev => ({ ...prev, end: e.target.value }))}
                    className={`flex-1 p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-colors ${
                      darkMode
                        ? 'bg-slate-800/50 border border-slate-600 text-white'
                        : 'bg-white/50 border border-slate-300 text-slate-900'
                    }`}
                    placeholder="BitiÅŸ Tarihi"
                  />
                  {(searchTerm || filterResult || filterCaller || filterCity || filterDateRange.start || filterDateRange.end) && (
                    <button
                      onClick={() => {
                        setSearchTerm('');
                        setFilterResult('');
                        setFilterCaller('');
                        setFilterCity('');
                        setFilterDateRange({ start: '', end: '' });
                      }}
                      className={`p-2 rounded-lg transition-colors ${
                        darkMode
                          ? 'bg-red-900/30 text-red-400 hover:bg-red-900/50'
                          : 'bg-red-100 text-red-600 hover:bg-red-200'
                      }`}
                      title="TÃ¼m Filtreleri Temizle"
                    >
                      <X size={20} />
                    </button>
                  )}
                </div>
              </div>
            </div>

            <CallsTable
              data={paginatedCalls}
              title={searchTerm || filterResult || filterCaller || filterCity || filterDateRange.start || filterDateRange.end ? "FiltrelenmiÅŸ SonuÃ§lar" : "TÃ¼m Arama KayÄ±tlarÄ±"}
              onDownload={() => exportToExcel(filteredCalls, "Filtreli_Arama_Kayitlari")}
              showPagination={true}
              darkMode={darkMode}
            />
          </div>
        )}
        {activeTab === 'reports' && <ReportsView />}
      </main>
    </div>
  );
}